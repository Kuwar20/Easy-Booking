import{R as c,c as se,m as ce,a as ie,b as be,j as o,w as Se,r as X,k as F,x as ke,q as Ee,y as je}from"./index-MjoGkJKq.js";import{u as Ne}from"./index.esm-JOZrsEaS.js";import{P as u}from"./index-mkIuW6Mz.js";import{u as Oe}from"./useMutation-zklkFzjD.js";function Z(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function ee(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Z(Object(t),!0).forEach(function(r){ue(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Z(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function U(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?U=function(e){return typeof e}:U=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(n)}function ue(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function $(n,e){return Pe(n)||Re(n,e)||Ie(n,e)||Ae()}function Pe(n){if(Array.isArray(n))return n}function Re(n,e){var t=n&&(typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"]);if(t!=null){var r=[],i=!0,a=!1,l,m;try{for(t=t.call(n);!(i=(l=t.next()).done)&&(r.push(l.value),!(e&&r.length===e));i=!0);}catch(s){a=!0,m=s}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw m}}return r}}function Ie(n,e){if(n){if(typeof n=="string")return te(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return te(n,e)}}function te(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function Ae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var K=function(e){var t=c.useRef(e);return c.useEffect(function(){t.current=e},[e]),t.current},P=function(e){return e!==null&&U(e)==="object"},we=function(e){return P(e)&&typeof e.then=="function"},Te=function(e){return P(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},ne="[object Object]",Be=function n(e,t){if(!P(e)||!P(t))return e===t;var r=Array.isArray(e),i=Array.isArray(t);if(r!==i)return!1;var a=Object.prototype.toString.call(e)===ne,l=Object.prototype.toString.call(t)===ne;if(a!==l)return!1;if(!a&&!r)return e===t;var m=Object.keys(e),s=Object.keys(t);if(m.length!==s.length)return!1;for(var y={},b=0;b<m.length;b+=1)y[m[b]]=!0;for(var g=0;g<s.length;g+=1)y[s[g]]=!0;var x=Object.keys(y);if(x.length!==m.length)return!1;var E=e,R=t,S=function(O){return n(E[O],R[O])};return x.every(S)},le=function(e,t,r){return P(e)?Object.keys(e).reduce(function(i,a){var l=!P(t)||!Be(e[a],t[a]);return r.includes(a)?(l&&console.warn("Unsupported prop change: options.".concat(a," is not a mutable property.")),i):l?ee(ee({},i||{}),{},ue({},a,e[a])):i},null):null},de="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",re=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:de;if(e===null||Te(e))return e;throw new Error(t)},Le=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:de;if(we(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(i){return re(i,t)})};var r=re(e,t);return r===null?{tag:"empty"}:{tag:"sync",stripe:r}},De=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"2.4.0"}),e.registerAppInfo({name:"react-stripe-js",version:"2.4.0",url:"https://stripe.com/docs/stripe-js/react"}))},fe=c.createContext(null);fe.displayName="CustomCheckoutSdkContext";var _e=function(e,t){if(!e)throw new Error("Could not find CustomCheckoutProvider context; You need to wrap the part of your app that ".concat(t," in an <CustomCheckoutProvider> provider."));return e},Me=c.createContext(null);Me.displayName="CustomCheckoutContext";u.any,u.shape({clientSecret:u.string.isRequired,elementsOptions:u.object}).isRequired;var ae=function(e){var t=c.useContext(fe),r=c.useContext(z);if(t&&r)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CustomCheckoutProvider> and <Elements> providers."));return t?_e(t,e):Ue(r,e)},z=c.createContext(null);z.displayName="ElementsContext";var Ue=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},H=c.createContext(null);H.displayName="CartElementContext";var $e=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},me=function(e){var t=e.stripe,r=e.options,i=e.children,a=c.useMemo(function(){return Le(t)},[t]),l=c.useState(null),m=$(l,2),s=m[0],y=m[1],b=c.useState(null),g=$(b,2),x=g[0],E=g[1],R=c.useState(function(){return{stripe:a.tag==="sync"?a.stripe:null,elements:a.tag==="sync"?a.stripe.elements(r):null}}),S=$(R,2),v=S[0],O=S[1];c.useEffect(function(){var j=!0,T=function(B){O(function(L){return L.stripe?L:{stripe:B,elements:B.elements(r)}})};return a.tag==="async"&&!v.stripe?a.stripePromise.then(function(N){N&&j&&T(N)}):a.tag==="sync"&&!v.stripe&&T(a.stripe),function(){j=!1}},[a,v,r]);var I=K(t);c.useEffect(function(){I!==null&&I!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[I,t]);var w=K(r);return c.useEffect(function(){if(v.elements){var j=le(r,w,["clientSecret","fonts"]);j&&v.elements.update(j)}},[r,w,v.elements]),c.useEffect(function(){De(v.stripe)},[v.stripe]),c.createElement(z.Provider,{value:v},c.createElement(H.Provider,{value:{cart:s,setCart:y,cartState:x,setCartState:E}},i))};me.propTypes={stripe:u.any,options:u.object};var We={cart:null,cartState:null,setCart:function(){},setCartState:function(){}},oe=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=c.useContext(H);return t?We:$e(r,e)};u.func.isRequired;var C=function(e,t,r){var i=!!r,a=c.useRef(r);c.useEffect(function(){a.current=r},[r]),c.useEffect(function(){if(!i||!e)return function(){};var l=function(){a.current&&a.current.apply(a,arguments)};return e.on(t,l),function(){e.off(t,l)}},[i,t,e,a])},Ye=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},d=function(e,t){var r="".concat(Ye(e),"Element"),i=function(s){var y=s.id,b=s.className,g=s.options,x=g===void 0?{}:g,E=s.onBlur,R=s.onFocus,S=s.onReady,v=s.onChange,O=s.onEscape,I=s.onClick,w=s.onLoadError,j=s.onLoaderStart,T=s.onNetworksChange,N=s.onCheckout,B=s.onLineItemClick,L=s.onConfirm,pe=s.onCancel,he=s.onShippingAddressChange,Ce=s.onShippingRateChange,A=ae("mounts <".concat(r,">")),D="elements"in A?A.elements:null,_="customCheckoutSdk"in A?A.customCheckoutSdk:null,ve=c.useState(null),J=$(ve,2),h=J[0],ye=J[1],k=c.useRef(null),W=c.useRef(null),V=oe("mounts <".concat(r,">"),"customCheckoutSdk"in A),Y=V.setCart,q=V.setCartState;C(h,"blur",E),C(h,"focus",R),C(h,"escape",O),C(h,"click",I),C(h,"loaderror",w),C(h,"loaderstart",j),C(h,"networkschange",T),C(h,"lineitemclick",B),C(h,"confirm",L),C(h,"cancel",pe),C(h,"shippingaddresschange",he),C(h,"shippingratechange",Ce);var M;e==="cart"?M=function(Q){q(Q),S&&S(Q)}:S&&(e==="expressCheckout"?M=S:M=function(){S(h)}),C(h,"ready",M);var ge=e==="cart"?function(p){q(p),v&&v(p)}:v;C(h,"change",ge);var xe=e==="cart"?function(p){q(p),N&&N(p)}:N;C(h,"checkout",xe),c.useLayoutEffect(function(){if(k.current===null&&W.current!==null&&(D||_)){var p=null;_?p=_.createElement(e,x):D&&(p=D.create(e,x)),e==="cart"&&Y&&Y(p),k.current=p,ye(p),p&&p.mount(W.current)}},[D,_,x,Y]);var G=K(x);return c.useEffect(function(){if(k.current){var p=le(x,G,["paymentRequest"]);p&&k.current.update(p)}},[x,G]),c.useLayoutEffect(function(){return function(){if(k.current&&typeof k.current.destroy=="function")try{k.current.destroy(),k.current=null}catch{}}},[]),c.createElement("div",{id:y,className:b,ref:W})},a=function(s){var y=ae("mounts <".concat(r,">"));oe("mounts <".concat(r,">"),"customCheckoutSdk"in y);var b=s.id,g=s.className;return c.createElement("div",{id:b,className:g})},l=t?a:i;return l.propTypes={id:u.string,className:u.string,onChange:u.func,onBlur:u.func,onFocus:u.func,onReady:u.func,onEscape:u.func,onClick:u.func,onLoadError:u.func,onLoaderStart:u.func,onNetworksChange:u.func,onCheckout:u.func,onLineItemClick:u.func,onConfirm:u.func,onCancel:u.func,onShippingAddressChange:u.func,onShippingRateChange:u.func,options:u.object},l.displayName=r,l.__elementType=e,l},f=typeof window>"u",qe=c.createContext(null);qe.displayName="EmbeddedCheckoutProviderContext";d("auBankAccount",f);var Fe=d("card",f);d("cardNumber",f);d("cardExpiry",f);d("cardCvc",f);d("fpxBank",f);d("iban",f);d("idealBank",f);d("p24Bank",f);d("epsBank",f);d("payment",f);d("expressCheckout",f);d("paymentRequestButton",f);d("linkAuthentication",f);d("address",f);d("shippingAddress",f);d("cart",f);d("paymentMethodMessaging",f);d("affirmMessage",f);d("afterpayClearpayMessage",f);const Ke=({currentUser:n,paymentIntent:e})=>{const t=se(),{hotelId:r}=ce(),{showToast:i}=ie(),a=be(),{mutate:l,isLoading:m}=Oe(Se,{onSuccess:()=>{i({message:"Booking Saved!",type:"SUCCESS"}),setTimeout(()=>{a("/my-bookings")},1500)},onError:()=>{i({message:"Error saving booking",type:"ERROR"})}}),{handleSubmit:s,register:y}=Ne({defaultValues:{firstName:n.firstName,lastName:n.lastName,email:n.email,adultCount:t.adultCount,childCount:t.childCount,checkIn:t.checkIn.toISOString(),checkOut:t.checkOut.toISOString(),hotelId:r,totalCost:e.totalCost}}),b=async g=>{const x={id:"simulated_"+Date.now(),status:"succeeded"},E={...g,paymentIntentId:x.id};l(E)};return o.jsxs("form",{onSubmit:s(b),className:"grid grid-cols-1 gap-5 rounded-lg border border-slate-300 p-5",children:[o.jsx("span",{className:"text-3xl font-bold",children:"Confirm Your Details"}),o.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[o.jsxs("label",{className:"text-gray-700 text-sm font-bold flex-1",children:["First Name",o.jsx("input",{className:"mt-1 border rounded w-full py-2 px-3 text-gray-700 bg-gray-200 font-normal",type:"text",readOnly:!0,disabled:!0,...y("firstName")})]}),o.jsxs("label",{className:"text-gray-700 text-sm font-bold flex-1",children:["Last Name",o.jsx("input",{className:"mt-1 border rounded w-full py-2 px-3 text-gray-700 bg-gray-200 font-normal",type:"text",readOnly:!0,disabled:!0,...y("lastName")})]}),o.jsxs("label",{className:"text-gray-700 text-sm font-bold flex-1",children:["Email",o.jsx("input",{className:"mt-1 border rounded w-full py-2 px-3 text-gray-700 bg-gray-200 font-normal",type:"text",readOnly:!0,disabled:!0,...y("email")})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h2",{className:"text-xl font-semibold",children:"Your Price Summary"}),o.jsxs("div",{className:"bg-blue-200 p-4 rounded-md",children:[o.jsxs("div",{className:"font-semibold text-lg",children:["Total Cost: ₹",e.totalCost.toFixed(2)]}),o.jsx("div",{className:"text-xs",children:" Includes taxes and charges"})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("h3",{className:"text-xl font-semibold",children:["Payment Details ",o.jsx("span",{className:"text-red-500",children:"*"})]}),o.jsx(Fe,{id:"payment-element",className:"border rounded-md p-2 text-sm",options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}})]}),o.jsx("div",{className:"flex justify-end",children:o.jsx("button",{disabled:m,hidden:!e.clientSecret,type:"submit",className:"bg-blue-600 text-white p-2 font-bold hover:bg-blue-500 text-md disabled:bg-gray-500",children:m?"Saving...":"Confirm Booking"})})]})},ze=({checkIn:n,checkOut:e,adultCount:t,childCount:r,numberOfNights:i,hotel:a})=>o.jsxs("div",{className:"grid gap-4 rounded-lg border border-slate-300 p-5 h-fit",children:[o.jsx("h2",{className:"text-xl font-bold",children:"Your Booking Details"}),o.jsxs("div",{className:"border-b py-2",children:["Location:",o.jsx("div",{className:"font-bold",children:`${a.name}, ${a.city}, ${a.country}`})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsxs("div",{children:["Check-in:",o.jsxs("div",{className:"font-bold",children:[" ",n.toDateString()]})]}),o.jsxs("div",{children:["Check-out:",o.jsxs("div",{className:"font-bold",children:[" ",e.toDateString()]})]})]}),o.jsxs("div",{className:"border-t border-b py-2",children:["Total length of stay:",o.jsxs("div",{className:"font-bold",children:[i," nights"]})]}),o.jsxs("div",{children:["Guests:"," ",o.jsxs("div",{className:"font-bold",children:[t," adults & ",r," children"]})]})]}),Qe=()=>{const{stripePromise:n}=ie(),e=se(),{hotelId:t}=ce(),[r,i]=X.useState(0);X.useEffect(()=>{if(e.checkIn&&e.checkOut){const s=Math.abs(e.checkOut.getTime()-e.checkIn.getTime())/864e5;i(Math.ceil(s))}},[e.checkIn,e.checkOut]);const{data:a}=F("createPaymentIntent",()=>ke(t,r.toString()),{enabled:!!t&&r>0}),{data:l}=F("fetchHotelByID",()=>Ee(t),{enabled:!!t}),{data:m}=F("fetchCurrentUser",je);return l?o.jsxs("div",{className:"grid md:grid-cols-[1fr_2fr]",children:[o.jsx(ze,{checkIn:e.checkIn,checkOut:e.checkOut,adultCount:e.adultCount,childCount:e.childCount,numberOfNights:r,hotel:l}),m&&a&&o.jsx(me,{stripe:n,options:{clientSecret:a.clientSecret},children:o.jsx(Ke,{currentUser:m,paymentIntent:a})})]}):o.jsx(o.Fragment,{})};export{Qe as default};
